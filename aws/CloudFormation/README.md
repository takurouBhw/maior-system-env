# CloudFormationの利用

CloudFormationを利用することで、あらかじめ定義された`.yml`ファイルを読み込むことにより、
VPC、EIP、EC2、セキュリティグループを手動で作成することなくテスト用開発環境の作成と削除ができます。

**※ EC2はAWSアカウント登録開始から12ヶ月間無料枠「稼働時間:1ヶ月 稼働750時間まで無料」
`t2.micro`を利用しています。
無料期間を終了すると有料となりますのでご注意ください。**

**注意点: 削除する場合は[スタックの削除手順](#スタックの削除手順)を踏み削除してください。**
個別にVPCやEC2等を削除すると削除漏れが発生する恐れがあります。
EIPなどが開放・削除されず金額請求される可能性があります。

## スタックの作成手順
1. EC2ダッシュボードでキーペアの作成を実施します。
2. 作成したキーペアのファイル名をコピーします。
3. `aws/ec2.yml`内`の以下の項目を変更してください。
    ```
    Ec2KeyName:
        Type: String
        Default: sample # ここを作成したキーペア名 *.pem(拡張子は不要)に変更
    ```

4. コンソールマネージャーの検索ボックスから`CloudFormation`と検索します。
5. `CloudFormation`をクリックすると画面右側に`CloudFormationスタックの作成`ボタンがあるのでクリックします。
6. 作成画面が表示されるので以下の選択項目に変更します。
    - テンプレートの準備
      - ラジオボタン: `テンプレートの準備完了` 
    -  テンプレートの指定
        - ラジオボタン: `テンプレートファイルのアップロード`
        - ファイルの選択: `aws/ec2.yml`を選択

7. `次へ`をクリックします。画面が表示されたら、`スタックの名前: 任意の名前`を入力し`次へ`をクリックします。<br>画面下部の`スタックの作成`をクリックします。(**作成まで数分時間がかかります**。)
- ダッシュボード左側のスタックから作成したスタックを選択し画面左側に中央付近に`CREATE_COMPLETE`と表示されていたら作成成功です。

1. 作成が完了したらEC2ダッシュボードに移動しインスタンスが起動いるか確認します。
無事起動していれば作成完了です。

## スタックの削除手順
1. `CloudFormation`ダッシュボード左側のスタックを選択します。
2. スタック一覧が表示されるので、作成したスタックのラジオボタンを選択し画面上部右側の削除ボタンをクリックします。(**削除まで数分時間がかかります**。)
   EC2ダッシュボードのインスタンスとEIPなどを確認し削除されていたら成功です。